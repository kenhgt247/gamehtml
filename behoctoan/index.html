<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>B√© Vui H·ªçc To√°n V2</title>
    <style>
        /* =========================================
           STYLE - GIAO DI·ªÜN & HI·ªÜU ·ª®NG
           ========================================= */
        :root {
            --primary: #FF6B6B;      /* ƒê·ªè cam */
            --secondary: #4ECDC4;    /* Xanh ng·ªçc */
            --accent: #FFE66D;       /* V√†ng */
            --dark: #2C3E50;
            --bg: #F7FFF7;
            --font: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0; padding: 0;
            font-family: var(--font);
            background-color: var(--bg);
            background-image: radial-gradient(#4ecdc422 2px, transparent 2px);
            background-size: 30px 30px; /* H·ªça ti·∫øt ch·∫•m bi */
            height: 100vh;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            color: var(--dark);
        }

        /* --- C√ÅC M√ÄN H√åNH --- */
        .screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: none; flex-direction: column; align-items: center; justify-content: center;
            padding: 20px; transition: opacity 0.3s;
        }
        .screen.active { display: flex; z-index: 10; }

        /* --- M√ÄN H√åNH START (Quan tr·ªçng ƒë·ªÉ b·∫≠t √¢m thanh) --- */
        #screen-start { background: linear-gradient(135deg, #FF6B6B, #FF8E53); color: white; text-align: center; }
        .big-logo { font-size: 5rem; margin-bottom: 20px; animation: bounce 2s infinite; }
        .start-btn {
            background: white; color: #FF6B6B;
            font-size: 2rem; font-weight: bold;
            padding: 20px 60px; border-radius: 50px; border: none;
            box-shadow: 0 10px 0 rgba(0,0,0,0.2);
            cursor: pointer; transition: transform 0.1s;
        }
        .start-btn:active { transform: translateY(5px); box-shadow: 0 5px 0 rgba(0,0,0,0.2); }

        /* --- M√ÄN H√åNH MENU --- */
        #level-container {
            width: 100%; max-width: 600px; height: 70vh;
            overflow-y: auto; padding: 10px;
            background: white; border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px;
        }
        .lvl-btn {
            aspect-ratio: 1; background: #eee; border-radius: 15px;
            display: flex; align-items: center; justify-content: center;
            font-weight: bold; font-size: 1.2rem; color: #999; cursor: pointer;
        }
        .lvl-btn.unlocked { background: var(--secondary); color: white; box-shadow: 0 4px 0 #3dbbb3; }
        .lvl-btn.locked { opacity: 0.5; cursor: not-allowed; }
        .lvl-btn.current { background: var(--primary); box-shadow: 0 4px 0 #e05555; transform: scale(1.1); }

        /* --- M√ÄN H√åNH GAME --- */
        .top-bar { width: 100%; max-width: 600px; display: flex; justify-content: space-between; margin-bottom: 20px; align-items: center; }
        .back-btn { background: none; border: none; font-size: 2rem; cursor: pointer; }
        
        .game-card {
            background: white; width: 100%; max-width: 500px;
            border-radius: 30px; padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center; border-bottom: 8px solid #ddd;
        }

        /* KHU V·ª∞C HI·ªÇN TH·ªä C√ÇU H·ªéI */
        .visual-area {
            min-height: 150px; display: flex; flex-wrap: wrap; 
            justify-content: center; align-items: center; gap: 10px;
            margin-bottom: 20px;
        }
        /* Icon SVG */
        .svg-icon { width: 60px; height: 60px; animation: pop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        
        .question-text { font-size: 1.8rem; font-weight: bold; margin-bottom: 30px; color: var(--dark); }

        /* N√öT ƒê√ÅP √ÅN */
        .answers-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; width: 100%; }
        .ans-btn {
            background: #f8f9fa; border: 3px solid #e9ecef;
            border-radius: 20px; padding: 20px;
            font-size: 2rem; font-weight: bold; color: var(--dark);
            cursor: pointer; transition: all 0.2s;
        }
        .ans-btn:active { transform: scale(0.95); }
        .ans-btn.correct { background: #d4edda; border-color: #28a745; color: #155724; }
        .ans-btn.wrong { background: #f8d7da; border-color: #dc3545; animation: shake 0.4s; }

        /* --- ANIMATION --- */
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }
        @keyframes pop { from { transform: scale(0); } to { transform: scale(1); } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-10px); } 75% { transform: translateX(10px); } }

    </style>
</head>
<body>

    <div id="screen-start" class="screen active">
        <div class="big-logo">üê±üê∂üçé</div>
        <h1>B√â VUI H·ªåC TO√ÅN</h1>
        <p>B·∫•m n√∫t b√™n d∆∞·ªõi ƒë·ªÉ ch∆°i nh√©!</p>
        <br>
        <button class="start-btn" onclick="App.startApp()">CH∆†I NGAY ‚ñ∂Ô∏è</button>
    </div>

    <div id="screen-menu" class="screen">
        <h2 style="color: var(--primary);">CH·ªåN M√ÄN CH∆†I</h2>
        <div id="level-container"></div>
    </div>

    <div id="screen-game" class="screen">
        <div class="top-bar">
            <button class="back-btn" onclick="App.goMenu()">üîô</button>
            <h3 style="margin:0">M√†n <span id="lbl-level">1</span></h3>
            <span style="font-size: 1.5rem">‚≠ê <span id="lbl-score">0</span></span>
        </div>

        <div class="game-card">
            <div class="visual-area" id="visual-container"></div>
            
            <div class="question-text" id="question-text"></div>

            <div class="answers-grid" id="answers-container"></div>
        </div>
        
        <div id="feedback-msg" style="height: 30px; margin-top: 20px; font-weight: bold; color: var(--primary);"></div>
    </div>

    <script>
        /**
         * =========================================
         * 1. ASSETS - H√åNH ·∫¢NH SVG (Con v·∫≠t, hoa qu·∫£)
         * =========================================
         */
        const SVGS = {
            apple: '<svg viewBox="0 0 512 512"><path fill="#ff6b6b" d="M256 0c-44 0-80 36-80 80 0 32 18 60 45 73-64 12-114 62-126 128H80c-26 0-48 22-48 48s22 48 48 48h10c8 58 55 104 114 111 26 2 52-6 73-22 21 16 47 24 73 22 59-7 106-53 114-111h10c26 0 48-22 48-48s-22-48-48-48h-15c-12-66-62-116-126-128 27-13 45-41 45-73 0-44-36-80-80-80z"/><path fill="#8bc34a" d="M256 0c10 0 20 5 30 10-20 20-20 60-10 80-20-5-40-30-20-90z"/></svg>',
            orange: '<svg viewBox="0 0 512 512"><circle cx="256" cy="256" r="200" fill="#FF9F43"/><circle cx="256" cy="256" r="180" fill="#FFB74D"/></svg>',
            strawberry: '<svg viewBox="0 0 512 512"><path fill="#EF5350" d="M256 64c-80 0-140 60-160 140 0 120 80 220 160 260 80-40 160-140 160-260-20-80-80-140-160-140z"/><path fill="#66BB6A" d="M256 32l-40 60h80z"/></svg>',
            cat: '<svg viewBox="0 0 512 512"><path fill="#FFD166" d="M120 120l40 80h192l40-80-80 40-96 0z"/><circle cx="256" cy="300" r="140" fill="#FFD166"/><circle cx="200" cy="280" r="15" fill="#333"/><circle cx="312" cy="280" r="15" fill="#333"/><path fill="#FF6B6B" d="M256 320l-20 20h40z"/></svg>',
            dog: '<svg viewBox="0 0 512 512"><path fill="#A1887F" d="M100 150l60 100h192l60-100-80 60-116 0z"/><rect x="136" y="200" width="240" height="240" rx="40" fill="#A1887F"/><circle cx="200" cy="280" r="15" fill="#333"/><circle cx="312" cy="280" r="15" fill="#333"/><rect x="236" y="320" width="40" height="30" rx="15" fill="#333"/></svg>',
            duck: '<svg viewBox="0 0 512 512"><path fill="#FFEB3B" d="M100 250q0-80 80-80h100q80 0 80 80v50q0 80-80 80h-100q-80 0-80-80z"/><circle cx="200" cy="230" r="15" fill="#333"/><path fill="#FF9800" d="M360 250l60 20-60 20z"/></svg>'
        };

        const ICON_KEYS = Object.keys(SVGS);

        /**
         * =========================================
         * 2. AUDIO ENGINE (√Çm thanh t·ªïng h·ª£p)
         * =========================================
         */
        const AudioSys = {
            ctx: null,
            init() {
                // T·∫°o AudioContext ngay khi ng∆∞·ªùi d√πng b·∫•m "CH∆†I NGAY"
                if (!this.ctx) {
                    this.ctx = new (window.AudioContext || window.webkitAudioContext)();
                }
                if (this.ctx.state === 'suspended') {
                    this.ctx.resume();
                }
            },
            beep(freq, type, duration) {
                if (!this.ctx) return;
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.type = type; // 'sine', 'square', 'sawtooth', 'triangle'
                osc.frequency.setValueAtTime(freq, this.ctx.currentTime);
                
                gain.gain.setValueAtTime(0.1, this.ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.001, this.ctx.currentTime + duration);
                
                osc.connect(gain);
                gain.connect(this.ctx.destination);
                osc.start();
                osc.stop(this.ctx.currentTime + duration);
            },
            playCorrect() {
                // Ti·∫øng "Ting ting" vui tai
                this.beep(600, 'sine', 0.1);
                setTimeout(() => this.beep(1200, 'sine', 0.2), 100);
            },
            playWrong() {
                // Ti·∫øng "Buzz" tr·∫ßm
                this.beep(150, 'sawtooth', 0.3);
            },
            playWin() {
                // Nh·∫°c chi·∫øn th·∫Øng
                [400, 500, 600, 800].forEach((f, i) => setTimeout(() => this.beep(f, 'square', 0.2), i*150));
            }
        };

        /**
         * =========================================
         * 3. LOGIC GAME & SINH C√ÇU H·ªéI
         * =========================================
         */
        const GameData = {
            level: 1,
            unlocked: 1,
            // H√†m sinh c√¢u h·ªèi t·ª± ƒë·ªông
            generate(level) {
                const type = level <= 20 ? 'COUNT' : (level <= 50 ? 'MATH' : 'LOGIC');
                const icon = ICON_KEYS[Math.floor(Math.random() * ICON_KEYS.length)];
                
                let q = { html: '', text: '', correct: 0, options: [] };

                if (type === 'COUNT') {
                    // ƒê·∫æM S·ªê L∆Ø·ª¢NG CON V·∫¨T/HOA QU·∫¢
                    const count = Math.min(level + 1, 10); // TƒÉng ƒë·ªô kh√≥
                    const num = Math.floor(Math.random() * count) + 1; // S·ªë l∆∞·ª£ng 1 -> count
                    q.correct = num;
                    q.text = `C√≥ bao nhi√™u h√¨nh?`;
                    
                    // T·∫°o HTML h√¨nh ·∫£nh
                    let html = '';
                    for(let i=0; i<num; i++) html += `<div class="svg-icon">${SVGS[icon]}</div>`;
                    q.html = html;

                } else if (type === 'MATH') {
                    // PH√âP T√çNH (C√≥ minh h·ªça nh·ªè)
                    const a = Math.floor(Math.random() * 10);
                    const b = Math.floor(Math.random() * 5);
                    const isPlus = Math.random() > 0.5;
                    
                    if (isPlus) {
                        q.correct = a + b;
                        q.text = `${a} + ${b} = ?`;
                    } else {
                        const big = Math.max(a,b);
                        const small = Math.min(a,b);
                        q.correct = big - small;
                        q.text = `${big} - ${small} = ?`;
                    }
                    // Minh h·ªça trang tr√≠
                    q.html = `<div class="svg-icon" style="transform:scale(1.5)">${SVGS[icon]}</div>`;
                }

                // T·∫†O ƒê√ÅP √ÅN NHI·ªÑU
                q.options = [q.correct];
                while(q.options.length < 4) {
                    let r = q.correct + Math.floor(Math.random() * 5) - 2;
                    if (r >= 0 && !q.options.includes(r)) q.options.push(r);
                }
                q.options.sort(() => Math.random() - 0.5);

                return q;
            }
        };

        /**
         * =========================================
         * 4. UI CONTROLLER
         * =========================================
         */
        const App = {
            currentQ: null,
            
            startApp() {
                AudioSys.init(); // K√≠ch ho·∫°t √¢m thanh ngay l·∫≠p t·ª©c
                this.renderLevels();
                this.switchScreen('screen-menu');
            },

            renderLevels() {
                const grid = document.getElementById('level-container');
                grid.innerHTML = '';
                for(let i=1; i<=100; i++) {
                    const btn = document.createElement('div');
                    btn.className = `lvl-btn ${i <= GameData.unlocked ? 'unlocked' : 'locked'}`;
                    btn.innerText = i;
                    if(i === GameData.unlocked) btn.classList.add('current');
                    
                    btn.onclick = () => {
                        if(i <= GameData.unlocked) this.startGame(i);
                    };
                    grid.appendChild(btn);
                }
            },

            startGame(lvl) {
                GameData.level = lvl;
                document.getElementById('lbl-level').innerText = lvl;
                this.loadQuestion();
                this.switchScreen('screen-game');
            },

            loadQuestion() {
                document.getElementById('feedback-msg').innerText = '';
                this.currentQ = GameData.generate(GameData.level);
                
                // Hi·ªÉn th·ªã
                document.getElementById('visual-container').innerHTML = this.currentQ.html;
                document.getElementById('question-text').innerText = this.currentQ.text;

                const grid = document.getElementById('answers-container');
                grid.innerHTML = '';

                this.currentQ.options.forEach(opt => {
                    const btn = document.createElement('button');
                    btn.className = 'ans-btn';
                    btn.innerText = opt;
                    btn.onclick = (e) => this.checkAnswer(opt, e.target);
                    grid.appendChild(btn);
                });
            },

            checkAnswer(ans, btn) {
                if (ans === this.currentQ.correct) {
                    // ƒê√öNG
                    btn.classList.add('correct');
                    document.getElementById('feedback-msg').innerText = "Hoan h√¥! ƒê√∫ng r·ªìi!";
                    AudioSys.playCorrect();
                    
                    // Logic th·∫Øng c·∫•p ƒë·ªô (·ªü ƒë√¢y l√†m ƒë∆°n gi·∫£n: 1 c√¢u ƒë√∫ng = qua m√†n)
                    setTimeout(() => {
                        if(GameData.level === GameData.unlocked) GameData.unlocked++;
                        this.goMenu();
                    }, 1200);

                } else {
                    // SAI
                    btn.classList.add('wrong');
                    document.getElementById('feedback-msg').innerText = "Sai r·ªìi, th·ª≠ l·∫°i nh√©!";
                    AudioSys.playWrong();
                }
            },

            goMenu() {
                this.renderLevels();
                this.switchScreen('screen-menu');
            },

            switchScreen(id) {
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                document.getElementById(id).classList.add('active');
            }
        };

    </script>
</body>
</html>
