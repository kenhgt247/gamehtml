<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√© Th√¥ng Minh ‚Äì V∆∞∆°ng Qu·ªëc To√°n H·ªçc</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap');

        :root {
            --bg-color: #FDFCF0;
            --primary-blue: #3B82F6;
            --primary-pink: #EC4899;
            --primary-green: #22C55E;
            --primary-yellow: #EAB308;
            --text-dark: #1F2937;
            --card-shadow: 0 20px 50px rgba(0,0,0,0.1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Quicksand', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-dark);
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            user-select: none;
        }

        /* Decorations */
        .decor {
            position: fixed;
            border-radius: 50%;
            z-index: -1;
            opacity: 0.2;
            animation: float 10s ease-in-out infinite;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-40px) scale(1.1); }
        }

        /* Main Container */
        #game-app {
            width: 95%;
            max-width: 800px;
            background: white;
            border-radius: 40px;
            padding: 30px;
            box-shadow: var(--card-shadow);
            position: relative;
            text-align: center;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 10;
        }

        .shake { animation: shake 0.4s ease; }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20% { transform: translateX(-15px); }
            40% { transform: translateX(15px); }
            60% { transform: translateX(-10px); }
            80% { transform: translateX(10px); }
        }

        /* Screens */
        .screen { display: none; flex-direction: column; align-items: center; animation: fadeIn 0.5s ease; }
        .screen.active { display: flex; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* Typography */
        h1 { font-size: 3.5rem; font-weight: 900; color: var(--primary-blue); margin-bottom: 15px; line-height: 1.1; }
        h1 span { color: var(--primary-pink); font-size: 0.7em; display: block; }
        h2 { font-size: 2.2rem; font-weight: 800; color: #374151; margin-bottom: 25px; }

        /* Buttons */
        .btn {
            display: inline-block;
            cursor: pointer;
            border: none;
            border-radius: 30px;
            font-weight: 700;
            transition: all 0.2s;
            box-shadow: 0 10px 0 rgba(0,0,0,0.1);
            text-decoration: none;
            font-family: inherit;
        }
        .btn:active { transform: translateY(6px); box-shadow: 0 4px 0 rgba(0,0,0,0.1); }

        .btn-start { background: var(--primary-green); color: white; padding: 25px 60px; font-size: 1.8rem; margin-top: 20px; box-shadow: 0 10px 0 #16a34a; }
        .btn-option { 
            background: white; 
            border: 4px solid #F3F4F6; 
            color: var(--primary-blue); 
            font-size: 2.5rem; 
            padding: 20px; 
            width: 100%; 
            border-radius: 35px;
            box-shadow: 0 8px 0 #E5E7EB;
        }
        .btn-option:hover { border-color: var(--primary-blue); background: #EFF6FF; }
        .btn-option:disabled { opacity: 0.6; cursor: default; }

        /* Grid for Options */
        .options-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; width: 100%; max-width: 550px; margin: 0 auto; }
        @media (min-width: 600px) { .options-grid { grid-template-columns: repeat(4, 1fr); } }

        /* Board Area */
        .board {
            background: #F9FAFB;
            border: 5px dashed #E5E7EB;
            border-radius: 40px;
            padding: 30px;
            margin-bottom: 30px;
            min-height: 250px;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .item-group { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; max-width: 300px; }
        .emoji { font-size: 4.5rem; display: inline-block; animation: pop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) backwards; }
        @keyframes pop { 0% { transform: scale(0); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }

        /* HUD */
        .hud { position: fixed; top: 20px; left: 20px; right: 20px; display: flex; justify-content: space-between; align-items: center; pointer-events: none; z-index: 100; }
        .hud-btn { pointer-events: auto; background: white; border-radius: 50%; width: 55px; height: 55px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; cursor: pointer; box-shadow: 0 5px 15px rgba(0,0,0,0.1); border: none; transition: transform 0.2s; }
        .hud-btn:hover { transform: scale(1.1); }
        .progress-container { flex: 1; margin: 0 25px; max-width: 450px; pointer-events: auto; }
        .progress-bg { height: 16px; background: #E5E7EB; border-radius: 20px; overflow: hidden; border: 3px solid white; box-shadow: inset 0 2px 4px rgba(0,0,0,0.1); }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #4ade80, #22c55e); width: 0%; transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1); }

        /* Feedback Text */
        #feedback { font-size: 1.8rem; font-weight: 800; color: var(--primary-green); margin-top: 25px; height: 40px; text-shadow: 1px 1px 0 rgba(0,0,0,0.05); }

        /* Confetti Canvas */
        #confetti { position: fixed; inset: 0; pointer-events: none; z-index: 99; display: none; }

        .symbol { font-size: 3.5rem; font-weight: 900; color: #D1D5DB; }
    </style>
</head>
<body>

    <!-- Decoration Blobs -->
    <div class="decor" style="width: 250px; height: 250px; background: #DBEAFE; top: -80px; right: -80px;"></div>
    <div class="decor" style="width: 350px; height: 350px; background: #FCE7F3; bottom: -120px; left: -120px; animation-delay: 2s;"></div>
    <div class="decor" style="width: 150px; height: 150px; background: #FEF3C7; top: 20%; left: 5%; animation-delay: 4s;"></div>

    <!-- HUD (UI Overlay) -->
    <div class="hud">
        <button id="toggle-sound" class="hud-btn">üîä</button>
        <div id="progress-hud" class="progress-container" style="display: none;">
            <div class="progress-bg"><div id="progress-fill" class="progress-fill"></div></div>
            <div style="display: flex; justify-content: space-between; margin-top: 8px;">
                <span id="level-label" style="font-size: 12px; font-weight: 800; color: #9CA3AF; letter-spacing: 1px;">M√ÄN 1</span>
                <span style="font-size: 12px; font-weight: 800; color: #9CA3AF; letter-spacing: 1px;">6 TH·ª¨ TH√ÅCH</span>
            </div>
        </div>
        <button id="btn-home" class="hud-btn">üè†</button>
    </div>

    <!-- Main Game App -->
    <div id="game-app">
        
        <!-- Start Screen -->
        <div id="screen-start" class="screen active">
            <div style="font-size: 6rem; margin-bottom: 20px; animation: bounce 2s infinite;">üéà</div>
            <h1>B√â TH√îNG MINH<span>V∆Ø∆†NG QU·ªêC TO√ÅN H·ªåC</span></h1>
            <p style="color: #6B7280; margin-bottom: 40px; font-size: 1.2rem; font-weight: 600;">H·ªçc to√°n th·∫≠t vui c√πng c√°c b·∫°n nh·ªè!</p>
            <button id="btn-play" class="btn btn-start">B·∫ÆT ƒê·∫¶U üöÄ</button>
        </div>

        <!-- Playing Screen -->
        <div id="screen-playing" class="screen">
            <h2 id="question-text">ƒêang t·∫£i c√¢u h·ªèi...</h2>
            <div id="board" class="board"></div>
            <div id="options-grid" class="options-grid"></div>
            <div id="feedback"></div>
        </div>

        <!-- Win Screen -->
        <div id="screen-win" class="screen">
            <div style="font-size: 7rem; margin-bottom: 20px;">üéâ</div>
            <h1 style="color: var(--primary-yellow); font-size: 4.5rem;">GI·ªéI QU√Å!</h1>
            <p style="color: #6B7280; font-size: 1.6rem; margin-bottom: 40px; font-weight: 600;">B√© ƒë√£ v∆∞·ª£t qua t·∫•t c·∫£ th·ª≠ th√°ch!</p>
            <button id="btn-replay" class="btn btn-start" style="background: var(--primary-pink); box-shadow: 0 10px 0 #be185d;">CH∆†I L·∫†I üîÑ</button>
        </div>

    </div>

    <canvas id="confetti"></canvas>

    <script>
        // Game Logic
        const LEVELS = [
            { id: 1, type: 'COUNT', title: 'ƒê·∫øm ƒë·ªì v·∫≠t (1-5)', range: 5, icon: 'üçé' },
            { id: 2, type: 'COUNT', title: 'ƒê·∫øm ƒë·ªì v·∫≠t (1-10)', range: 10, icon: 'üê∂' },
            { id: 3, type: 'ADD', title: 'Ph√©p c·ªông (‚â§ 5)', range: 5, icon: '‚≠êÔ∏è' },
            { id: 4, type: 'ADD', title: 'Ph√©p c·ªông (‚â§ 10)', range: 10, icon: 'üê±' },
            { id: 5, type: 'SUB', title: 'Ph√©p tr·ª´ (‚â§ 5)', range: 5, icon: 'üçì' },
            { id: 6, type: 'MIXED', title: 'Th·ª≠ th√°ch t·ªïng h·ª£p', range: 10, icon: 'ü¶ã' }
        ];

        const ICONS = ['üçé', 'üçì', 'üê∂', 'üê±', '‚≠êÔ∏è', 'ü¶ã', 'üéà', 'üöó', 'ü¶Å', 'üç¶', 'üêß', 'üêº', 'üé®', 'üöÄ'];
        const MESSAGES = ["Gi·ªèi l·∫Øm!", "Tuy·ªát v·ªùi!", "Con l√†m r·∫•t t·ªët!", "Xu·∫•t s·∫Øc!", "Th√¥ng minh qu√°!", "Qu√° si√™u lu√¥n!"];

        let state = {
            currentLevelIndex: 0,
            question: null,
            soundOn: true,
            isAnswering: false
        };

        let audioCtx = null;

        // Sound Synthesis
        function playSfx(type) {
            if (!state.soundOn) return;
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            
            const now = audioCtx.currentTime;
            
            if (type === 'correct') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(523.25, now); // C5
                osc.frequency.exponentialRampToValueAtTime(1046.50, now + 0.1); // C6
                gain.gain.setValueAtTime(0, now);
                gain.gain.linearRampToValueAtTime(0.1, now + 0.05);
                gain.gain.linearRampToValueAtTime(0, now + 0.4);
                osc.start(now);
                osc.stop(now + 0.4);
            } else if (type === 'wrong') {
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(220, now); // A3
                osc.frequency.linearRampToValueAtTime(110, now + 0.2); // A2
                gain.gain.setValueAtTime(0.1, now);
                gain.gain.linearRampToValueAtTime(0, now + 0.3);
                osc.start(now);
                osc.stop(now + 0.3);
            } else if (type === 'win') {
                const notes = [523, 659, 783, 1046];
                notes.forEach((f, i) => {
                    const o = audioCtx.createOscillator();
                    const g = audioCtx.createGain();
                    o.connect(g);
                    g.connect(audioCtx.destination);
                    o.frequency.setValueAtTime(f, now + (i * 0.15));
                    g.gain.setValueAtTime(0, now + (i * 0.15));
                    g.gain.linearRampToValueAtTime(0.1, now + (i * 0.15) + 0.05);
                    g.gain.linearRampToValueAtTime(0, now + (i * 0.15) + 0.3);
                    o.start(now + (i * 0.15));
                    o.stop(now + (i * 0.15) + 0.3);
                });
            }
        }

        // Confetti Engine
        const confetti = {
            canvas: document.getElementById('confetti'),
            ctx: null,
            particles: [],
            active: false,
            init() {
                this.ctx = this.canvas.getContext('2d');
            },
            start() {
                this.canvas.style.display = 'block';
                this.canvas.width = window.innerWidth;
                this.canvas.height = window.innerHeight;
                this.active = true;
                this.particles = Array.from({ length: 120 }, () => ({
                    x: Math.random() * this.canvas.width,
                    y: Math.random() * this.canvas.height - this.canvas.height,
                    size: Math.random() * 10 + 5,
                    color: `hsl(${Math.random() * 360}, 80%, 60%)`,
                    vx: Math.random() * 4 - 2,
                    vy: Math.random() * 3 + 2,
                    angle: Math.random() * Math.PI * 2,
                    rot: Math.random() * 0.2 - 0.1
                }));
                this.loop();
            },
            loop() {
                if (!this.active) return;
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                this.particles.forEach(p => {
                    p.y += p.vy;
                    p.x += p.vx;
                    p.angle += p.rot;
                    if (p.y > this.canvas.height) p.y = -20;
                    this.ctx.fillStyle = p.color;
                    this.ctx.save();
                    this.ctx.translate(p.x, p.y);
                    this.ctx.rotate(p.angle);
                    this.ctx.fillRect(-p.size/2, -p.size/2, p.size, p.size);
                    this.ctx.restore();
                });
                requestAnimationFrame(() => this.loop());
            },
            stop() {
                this.active = false;
                this.canvas.style.display = 'none';
            }
        };

        // UI Helpers
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
            
            if (screenId === 'screen-playing') {
                document.getElementById('progress-hud').style.display = 'block';
            } else {
                document.getElementById('progress-hud').style.display = 'none';
            }
        }

        function createQuestion(levelIndex) {
            const level = LEVELS[levelIndex];
            const icon = ICONS[Math.floor(Math.random() * ICONS.length)];
            let type = level.type;
            if (type === 'MIXED') type = ['COUNT', 'ADD', 'SUB'][Math.floor(Math.random() * 3)];

            let q = { icon, type };

            if (type === 'COUNT') {
                q.correct = Math.floor(Math.random() * level.range) + 1;
                q.text = "C√≥ bao nhi√™u b·∫°n nh·ªè ƒë√¢y?";
                q.n1 = q.correct;
            } else if (type === 'ADD') {
                const a = Math.floor(Math.random() * (level.range - 1)) + 1;
                const b = Math.floor(Math.random() * (level.range - a)) + 1;
                q.correct = a + b;
                q.text = `${a} c·ªông ${b} l√† m·∫•y nh·ªâ?`;
                q.n1 = a; q.n2 = b; q.op = '+';
            } else { // SUB
                const a = Math.floor(Math.random() * (level.range - 1)) + 2;
                const b = Math.floor(Math.random() * (a - 1)) + 1;
                q.correct = a - b;
                q.text = `${a} tr·ª´ ${b} b·∫±ng bao nhi√™u?`;
                q.n1 = a; q.n2 = b; q.op = '-';
            }

            const options = new Set([q.correct]);
            while (options.size < 4) {
                let fake = q.correct + (Math.floor(Math.random() * 5) - 2);
                if (fake > 0 && fake <= 20) options.add(fake);
            }
            q.options = Array.from(options).sort((a, b) => a - b);
            return q;
        }

        function renderLevel() {
            const q = state.question;
            const board = document.getElementById('board');
            const grid = document.getElementById('options-grid');
            
            document.getElementById('question-text').innerText = q.text;
            document.getElementById('feedback').innerText = "";
            document.getElementById('level-label').innerText = `M√ÄN ${state.currentLevelIndex + 1}`;
            document.getElementById('progress-fill').style.width = `${((state.currentLevelIndex + 1) / LEVELS.length) * 100}%`;

            board.innerHTML = "";
            const group1 = document.createElement('div');
            group1.className = 'item-group';
            for (let i = 0; i < q.n1; i++) {
                const el = document.createElement('span');
                el.className = 'emoji';
                el.innerText = q.icon;
                el.style.animationDelay = `${i * 0.1}s`;
                group1.appendChild(el);
            }
            board.appendChild(group1);

            if (q.op) {
                const sym = document.createElement('span');
                sym.className = 'symbol';
                sym.innerText = q.op;
                board.appendChild(sym);

                const group2 = document.createElement('div');
                group2.className = 'item-group';
                for (let i = 0; i < q.n2; i++) {
                    const el = document.createElement('span');
                    el.className = 'emoji';
                    el.innerText = q.icon;
                    el.style.animationDelay = `${(q.n1 + i) * 0.1}s`;
                    group2.appendChild(el);
                }
                board.appendChild(group2);
            }

            grid.innerHTML = "";
            q.options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'btn btn-option';
                btn.innerText = opt;
                btn.onclick = () => handleChoice(opt, btn);
                grid.appendChild(btn);
            });
            
            state.isAnswering = false;
        }

        function handleChoice(val, btn) {
            if (state.isAnswering) return;
            
            if (val === state.question.correct) {
                state.isAnswering = true;
                playSfx('correct');
                document.getElementById('feedback').innerText = MESSAGES[Math.floor(Math.random() * MESSAGES.length)];
                btn.style.borderColor = 'var(--primary-green)';
                btn.style.backgroundColor = '#f0fdf4';
                
                setTimeout(() => {
                    if (state.currentLevelIndex < LEVELS.length - 1) {
                        state.currentLevelIndex++;
                        state.question = createQuestion(state.currentLevelIndex);
                        renderLevel();
                    } else {
                        win();
                    }
                }, 1500);
            } else {
                playSfx('wrong');
                document.getElementById('game-app').classList.add('shake');
                btn.style.borderColor = 'var(--primary-pink)';
                setTimeout(() => document.getElementById('game-app').classList.remove('shake'), 400);
            }
        }

        function win() {
            playSfx('win');
            confetti.start();
            showScreen('screen-win');
        }

        // Init App
        confetti.init();

        document.getElementById('btn-play').onclick = () => {
            state.currentLevelIndex = 0;
            state.question = createQuestion(0);
            showScreen('screen-playing');
            renderLevel();
        };

        document.getElementById('btn-replay').onclick = () => {
            confetti.stop();
            state.currentLevelIndex = 0;
            state.question = createQuestion(0);
            showScreen('screen-playing');
            renderLevel();
        };

        document.getElementById('btn-home').onclick = () => {
            confetti.stop();
            showScreen('screen-start');
        };

        document.getElementById('toggle-sound').onclick = function() {
            state.soundOn = !state.soundOn;
            this.innerText = state.soundOn ? "üîä" : "üîá";
        };

    </script>
</body>
</html>
